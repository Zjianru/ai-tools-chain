# 规划阶段用户旅程 - 完整体验流程设计

> 本文档从用户视角出发，重新梳理规划阶段的完整旅程。  
> 包括每一步用户的感受、系统的反应、以及可能遗漏的交互点。  
> 目标：发现设计中的漏洞和需要补完的地方。  
> 日期：2025-11-18

---

## 1. 用户旅程全景

```
用户启动阶段 → 需求输入 → 工作坊开始 → 多轮讨论 → 用户参与点 → 结果产出 → 版本迭代
```

---

## 2. 完整用户旅程详细分解

### 阶段 A：用户启动 & 准备

#### A1. 用户决策点："我要开始规划"

**用户心理**：
- 「我有一个开发需求，需要系统的规划」
- 「我不知道从哪里开始」
- 「我希望有个教练帮我梳理」

**系统应该提供**：
- ❓ 是否应该有"新规划"vs"继续前一个规划"的选择？
- ❓ 用户是否需要看到规划的"预期耗时"？
- ❓ 是否应该展示"规划会产出什么"的说明？

**当前设计的覆盖**：
- ✅ `/plan` 命令启动
- ❌ 启动前的"准备"或"说明"阶段缺失？

---

#### A2. 输入需求

**用户操作**：
```
/plan "我想为项目增加用户权限系统，支持角色和权限两级管理，需要与现有用户系统集成"
```

**用户期望**：
- 「系统能理解我的需求」
- 「系统会问我澄清问题」
- 「系统不会立即生成代码」

**系统应该做的**：
- ✅ 接收需求文本
- ❓ 是否应该做"需求预解析"？（提前标记缺失的关键信息）
- ❓ 是否应该展示"已理解的需求摘要"给用户看？
- ❓ 用户是否可以附加"前版规划报告 + 新意见"来做"规划升版"？

**当前设计的覆盖**：
- ✅ 接收需求
- ❌ 预解析和摘要反馈缺失？
- ❌ "规划升版"流程的细节不清？

---

### 阶段 B：工作坊启动 & 首轮讨论

#### B1. 敏捷教练的初判

**系统操作**（背后发生）：
```
敏捷教练收到用户需求
  ↓
判断：这个需求信息是否充分？
  ├─ 是 → 进入第1轮讨论
  └─ 否 → 进行用户澄清
```

**用户期望**：
- 「系统应该告诉我它是否理解我的需求」
- 「如果有疑问，系统应该主动问我」

**系统应该告诉用户**：
- ✅ "我正在启动工作坊..."
- ❓ 是否应该展示"正在进行初判"的进度？
- ❓ 初判的结果应该如何反馈给用户？

**当前设计的覆盖**：
- ✅ 初判逻辑存在（在敏捷教练中）
- ❌ UI/UX 反馈不清楚？

---

#### B2. 可能的用户澄清环节（第1个插入点）

**触发条件**：
- 敏捷教练判断需求信息不充分
- 例如：「需求涉及现有系统的什么部分？」

**用户操作**：
```
系统问：「你提到的'现有用户系统'是指什么？是否包括已有的用户数据库？」
用户答：「是的，我们有一个 MySQL 数据库，已经有 50 万用户。」
系统问：「那么新的权限系统需要与这 50 万用户绑定吗？」
用户答：「是的。」
```

**用户期望**：
- 「对话要自然、有逻辑」
- 「系统理解我的每个回答」
- 「系统在有足够信息后停止提问」

**系统应该做的**：
- ✅ 提出澄清问题
- ❓ 澄清对话应该轮数限制吗？还是自然停止？
- ❓ 用户是否可以随时说"我觉得没什么了"来停止澄清？
- ❓ 澄清内容如何在工作坊中被使用（作为新问题点？还是直接纳入需求？）

**当前设计的覆盖**：
- ✅ 澄清流程存在
- ❌ "什么时候停止澄清"的判断标准不清楚
- ❌ 澄清内容在工作坊中的位置不明确

---

#### B3. 第1轮讨论启动

**系统通知用户**：
```
「工作坊已启动，5位专家正在讨论你的需求...
- ProductPlanner 正在分析业务需求
- SystemDesigner 正在设计系统架构
- SeniorDeveloper 正在评估实现复杂度
- TestPlanner 正在规划测试策略
- RiskPlanner 正在评估风险」
```

**用户期望**：
- 「看到工作坊在进行」
- 「知道大概需要多久」
- 「想要实时看到讨论内容」 OR 「只想看最终结果」

**系统应该提供**：
- ✅ 进度提示
- ❓ 是否应该实时流送每个角色的发言给用户？
- ❓ 用户是否可以选择"实时观看"或"后台运行"模式？
- ❓ 是否有"暂停"功能让用户插入意见？

**当前设计的覆盖**：
- ✅ 第1轮讨论设计已有
- ❌ 用户界面的"可观测性"缺失
- ❌ 用户是否可以中途打断的机制不清

---

### 阶段 C：多轮讨论周期

#### C1. 每轮讨论中可能出现的用户澄清（插入点）

**场景**：第1轮讨论进行中
```
SystemDesigner 发言中提到：「权限系统是否涉及 API 级别的权限控制？」
  ↓
敏捷教练识别这是需要用户澄清的问题
  ↓
暂停当前讨论，与用户进行"小会"对话
  ↓
用户回答：「是的，我们需要细粒度的 API 权限控制」
  ↓
澄清内容纳入本轮问题清单
  ↓
继续 TestPlanner 的发言（已包含新澄清内容）
```

**用户期望**：
- 「系统及时发现问题」
- 「我能直接回答系统的澄清问题」
- 「我的回答能立即影响后续的讨论」

**系统应该做的**：
- ✅ 暂停、澄清、继续的流程
- ❓ "插入式澄清"是否会打断用户的心流？需要提示吗？
- ❓ 澄清对话中，如果用户说不确定，怎么办？
- ❓ 澄清对话完成后，是否应该"重新运行"已发言的角色？

**当前设计的覆盖**：
- ✅ 澄清流程设计已有
- ❌ 澄清后的"补救"流程不清楚（是否需要重新运行？）
- ❌ 用户界面的"中断处理"不清

---

#### C2. 轮次间的转换

**第1轮完成 → 第2轮准备**

**系统操作**：
```
敏捷教练汇总第1轮发言
  ↓
提取共识部分 → 纳入共识草案
提取新问题 → 更新问题清单
  ↓
是否还有未解决问题？
  ├─ 是 → 准备第2轮讨论
  └─ 否 → 进入最终输出
```

**用户期望**：
- 「了解第1轮的结果」
- 「知道第2轮会讨论什么」
- 「能看到共识进展」

**系统应该告诉用户**：
- ✅ "第1轮讨论已完成"
- ❓ 用户是否应该看到"第1轮的共识"和"新问题清单"？
- ❓ 用户是否可以在此时提出意见、要求"重新讨论某个问题"？
- ❓ 是否应该有"暂停进行下一轮"的选择？

**当前设计的覆盖**：
- ✅ 轮次转换逻辑存在
- ❌ 用户可见性和干预机制缺失

---

#### C3. 第2轮及后续轮次

**行为与第1轮相同**，但：
- 输入包含第1轮共识
- 问题清单更精细化
- 可能产生新的澄清需求

**用户期望**：
- 「讨论越来越深入」
- 「问题被逐步解决」
- 「知道何时结束」

**系统应该做的**：
- ✅ 重复第1轮的讨论流程
- ❓ 第2轮的"新问题清单"应该如何展示给用户？
- ❓ 如果第N轮产生了与第1轮相反的结论，怎么办？
- ❓ 是否有"讨论过度"或"讨论死循环"的风险？敏捷教练如何防止？

**当前设计的覆盖**：
- ✅ 多轮讨论框架存在
- ❌ "讨论何时结束"的判断标准不明确
- ❌ 讨论质量的"控制机制"不清

---

### 阶段 D：讨论收敛 & 共识达成

#### D1. "讨论结束"的判断

**关键问题**：
- ❓ 什么时候才能判断"讨论已经充分"？
- ❓ 是否有"轮次限制"？（例如最多5轮）
- ❓ 是否有"问题清单清空"的自动判断？
- ❓ 用户是否可以主动说"结束讨论"？

**当前设计的覆盖**：
- ❌ 讨论结束的条件非常模糊

---

#### D2. 最终共识的用户确认（插入点）

**场景**：所有轮次讨论完成，共识已形成

**系统应该做的**：
- ❓ 在生成最终规划报告前，是否应该把"最终共识"展示给用户？
- ❓ 用户是否可以对共识提出"不同意"或"需要调整"的意见？
- ❓ 如果用户提出异议，是否应该启动新一轮讨论？

**当前设计的覆盖**：
- ❌ "最终确认"机制完全缺失

---

### 阶段 E：结果产出

#### E1. 最终规划报告生成

**系统操作**：
```
5个 AI 角色输出各自的文档
  ↓
敏捷教练汇总、拼接
  ↓
生成 planning_report.md
```

**用户期望**：
- 「看到清晰的规划文档」
- 「文档涵盖了我关心的所有方面」
- 「能下载或查看完整内容」

**系统应该提供**：
- ✅ 规划报告
- ❓ 报告的结构应该是什么？（由各角色的文档简单拼接，还是重新组织？）
- ❓ 报告中是否应该包含"讨论过程"？（完整的 transcript）
- ❓ 用户是否可以选择"只看摘要"或"看完整版"？

**当前设计的覆盖**：
- ✅ 产出规划报告的框架存在
- ❌ 报告的"结构和呈现"方式不清

---

#### E2. 版本管理

**用户操作**：
```
产出的规划被放在：.ai-tools-chain/planning_outputs/v1/
用户查看后，觉得"权限隔离"讨论得不够深
用户想要升版规划
```

**用户操作**：
```
/plan "我对 v1 的规划有意见：权限隔离的话题需要深入讨论。
      另外，我想加入一个新需求：支持第三方应用的权限授权。"
```

**系统应该做的**：
- ✅ 接收升版请求
- ❓ v2 应该从头开始讨论，还是"继续 v1 的讨论"（hot resume）？
- ❓ v1 中已有的共识是否应该被自动导入 v2？
- ❓ 用户的"意见文本"应该如何纳入 v2 的讨论？

**当前设计的覆盖**：
- ✅ 版本存储的框架存在
- ❌ "版本关系"和"升版流程"不清

---

### 阶段 F：用户对规划的后续使用

#### F1. 代码生成前的规划确认

**场景**：规划完成后，用户准备进入代码生成阶段

**用户期望**：
- 「在开始代码生成前，我要确认规划是对的」
- 「我可能还想调整某些部分」

**系统应该提供**：
- ❓ 在从规划进入 codegen 前，是否应该有"最后确认"的步骤？
- ❓ 用户是否可以选择"只用规划的某个部分"来生成代码？

**当前设计的覆盖**：
- ❌ 规划和代码生成之间的"交接"不清

---

#### F2. 规划在后续阶段的角色

**场景**：代码审查、评测等阶段

**用户期望**：
- 「代码审查应该基于规划来进行」
- 「评测应该验证是否满足规划中的要求」

**系统应该做的**：
- ❓ 如何在 review 阶段引用规划？
- ❓ 如何在 test 阶段基于规划驱动评测？

**当前设计的覆盖**：
- ❌ 完全没有涉及

---

## 3. 发现的漏洞与需要补完的地方

### 关键漏洞

#### 漏洞1：用户的"可见性"不足
- ❌ 用户在工作坊进行中，是否应该实时看到讨论内容？
- ❌ 用户是否应该看到每轮的"共识进展"？
- ❌ 用户是否应该看到"问题清单的演变"？

**建议补完**：
- 设计用户的"观看模式"（实时/结果/离线）
- 明确每个阶段应该展示什么信息给用户

---

#### 漏洞2：用户的"干预点"不足
- ❌ 除了初始输入和澄清问答，用户还能做什么？
- ❌ 用户是否可以在中途提出意见？
- ❌ 用户是否可以要求"重新讨论某个话题"？
- ❌ 用户是否可以提前结束讨论？

**建议补完**：
- 明确用户可以在哪些时刻"介入"
- 设计"用户意见收集"的机制
- 决定这些干预是否会触发新的讨论轮次

---

#### 漏洞3：讨论结束的判断标准不清
- ❌ "第N轮讨论何时结束"没有明确标准
- ❌ "整个工作坊何时结束"没有明确标准
- ❌ 是否有讨论死循环的风险？

**建议补完**：
- 定义讨论结束的明确条件
- 定义"讨论质量"的评估方式
- 防止"无限循环"的机制

---

#### 漏洞4：澄清后的"补救"机制不清
- ❌ 澄清后，已发言的角色是否需要重新发言？
- ❌ 新澄清内容对后续讨论的影响如何处理？

**建议补完**：
- 决定"澄清后是否重新运行"的规则
- 如果需要重新运行，是全部角色还是部分角色？

---

#### 漏洞5：最终确认机制缺失
- ❌ 规划完成后，用户是否需要"签字确认"？
- ❌ 用户对最终规划不满意，该怎么办？

**建议补完**：
- 设计"最终确认"的流程
- 明确用户的"推翻"或"调整"权限

---

#### 漏洞6：版本升级的流程不清
- ❌ v2 应该从头开始还是热继续？
- ❌ v1 的共识是否应该在 v2 中被保留？
- ❌ 用户的升版意见应该如何处理？

**建议补完**：
- 决定版本升级的策略
- 明确共识在版本间的"继承"关系

---

#### 漏洞7：与后续阶段的交接不清
- ❌ 规划如何传递给代码生成？
- ❌ 代码审查如何引用规划？
- ❌ 评测如何基于规划来验证？

**建议补完**：
- 明确规划在整个任务生命周期中的角色
- 定义"规划→代码"和"规划→评测"的接口

---

#### 漏洞8：敏捷教练的"防控机制"不明确
- ❌ 如何防止讨论"偏离主题"？
- ❌ 如何防止讨论"过度深入"？
- ❌ 如何防止讨论"死循环"？

**建议补完**：
- 定义敏捷教练的"质量控制"职责
- 明确干预的时机和方式

---

### 其他需要补完的设计细节

#### 细节1：用户界面设计
- 如何呈现工作坊的进度？
- 如何呈现澄清对话？
- 如何呈现规划结果？

#### 细节2：时间管理
- 整个规划流程预期需要多久？
- 是否有超时的风险？
- 如何处理"长时间未响应"的情况？

#### 细节3：错误处理
- 如果某个 AI 角色"失败"了怎么办？
- 如果用户在澄清中提出"系统无法理解"的内容怎么办？
- 如果讨论陷入"僵局"怎么办？

#### 细节4：数据持久化
- 每个阶段的数据应该如何保存？
- 用户中途中断后如何恢复？
- 版本间的共识如何共享？

#### 细节5：规划报告的结构
- 应该包含哪些内容？
- 不同类型的用户（产品经理 vs 开发者）应该看到不同的视角吗？
- 是否应该生成"执行计划"？

---

## 4. 总结：需要完善的关键问题清单

下面是一份"必须回答"的问题清单，完成这些回答后，规划阶段的设计会更完整：

### 用户可观测性
- [ ] 用户应该如何实时观看工作坊的进度？
- [ ] 每个阶段应该向用户展示什么信息？
- [ ] 用户是否可以选择"离线运行"模式？

### 用户干预点
- [ ] 用户可以在哪些时刻"打断"工作坊提出意见？
- [ ] 用户的意见应该如何被纳入讨论？
- [ ] 用户是否可以要求"重新讨论某个话题"？

### 讨论收敛
- [ ] 讨论结束的明确标准是什么？
- [ ] 如何判断讨论是否已经充分？
- [ ] 如何防止讨论死循环？

### 澄清后处理
- [ ] 澄清后，已发言的角色是否需要重新发言？
- [ ] 新澄清内容的影响范围是什么？

### 最终确认
- [ ] 规划完成后，用户是否需要确认？
- [ ] 用户对规划不满意的"调整机制"是什么？

### 版本管理
- [ ] 升版规划应该从头开始还是热继续？
- [ ] v1 的共识是否应该在 v2 中继承？
- [ ] 用户的升版意见如何被处理？

### 后续交接
- [ ] 规划如何被代码生成、审查、评测所使用？
- [ ] 如何保证后续阶段与规划保持一致？

### 质量控制
- [ ] 敏捷教练如何防止讨论偏离或过度？
- [ ] 如何监测讨论的"健康度"？
- [ ] 什么情况下应该"人工干预"？

---

## 5. 下一步建议

1. **逐个回答上述问题清单中的问题**
2. **根据回答调整用户旅程**
3. **完善每个旅程节点的"系统设计"**
4. **识别每个节点的"失败场景"和"补救机制"**
5. **最终形成"完整的规划阶段使用手册"**

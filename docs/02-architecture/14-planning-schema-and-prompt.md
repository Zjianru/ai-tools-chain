# AI Planning Schema & Prompt Design (Draft)

| å±æ€§ | å€¼ |
|------|-----|
| **æœ€åæ›´æ–°** | 2025-11-18 |
| **ç‰ˆæœ¬** | v1.0 |
| **çŠ¶æ€** | âœ… Current |

---

## ğŸ“ æ›´æ–°å†å²

- **2025-11-18**: åˆç¨¿å®Œæˆ

---

> ç›®æ ‡ï¼šè®©æ¨¡å‹ä¸»å¯¼è§„åˆ’é˜¶æ®µçš„â€œå†…å®¹â€ï¼ŒåŒ…æ‹¬éœ€æ±‚æ‹†è§£ä¸ draft_files åˆ—è¡¨ï¼›ç”±ç¨‹åºæ ¹æ®ç»Ÿä¸€çš„ JSON schema æœºæ¢°ç”Ÿæˆ OpenSpec æ–‡æœ¬ä¸è¾…åŠ©æ–‡ä»¶ï¼›å¹¶æ”¯æŒå¤šè½®æ¾„æ¸…å¯¹è¯ä¸å®Œæ•´æ—¥å¿—ã€‚

---

## 1. é¡¶å±‚ç»“æ„ä¸ status åè®®

è§„åˆ’æ¨¡å‹ï¼ˆrole: `planning`ï¼‰çš„è¾“å‡ºçº¦å®šä¸ºä¸€ä¸ª JSON å¯¹è±¡ï¼š

```json
{
  "status": "need_clarification" | "ready",
  "questions": ["..."],
  "planning": { /* è§ä¸‹æ–‡ schema */ }
}
```

- `status`ï¼š
  - `"need_clarification"`ï¼šå½“å‰ä¿¡æ¯ä¸è¶³ä»¥å®‰å…¨ç”Ÿæˆè§„åˆ’ï¼Œåº”åœ¨ `questions` ä¸­ç»™å‡º 1â€“3 ä¸ªéœ€è¦ç”¨æˆ·å›ç­”çš„æ¾„æ¸…é—®é¢˜ï¼›æ­¤æ—¶ `planning` å¯ä¸º `null` æˆ–ç©ºå¯¹è±¡ã€‚
  - `"ready"`ï¼šä¿¡æ¯å……è¶³ï¼Œå¯ä»¥è¾“å‡ºå®Œæ•´è§„åˆ’ï¼›æ­¤æ—¶ `questions` åº”ä¸ºç©ºæ•°ç»„ï¼Œ`planning` å¿…é¡»ç¬¦åˆä¸‹æ–‡ schemaã€‚
- `questions`ï¼š
  - å½“ `status = "need_clarification"` æ—¶ä½¿ç”¨ï¼›
  - æ¯æ¬¡æœ€å¤š 3 ä¸ªé—®é¢˜ï¼Œèšç„¦äºå½±å“éœ€æ±‚å®šä¹‰ä¸è®¾è®¡å†³ç­–çš„å…³é”®ç‚¹ã€‚
- `planning`ï¼š
  - å½“ `status = "ready"` æ—¶å¿…é¡»å¡«å……ï¼›
  - æ‰¿è½½åç»­ OpenSpecã€codegenã€review æ‰€éœ€çš„å…¨éƒ¨ç»“æ„åŒ–ä¿¡æ¯ã€‚

---

## 2. planning.ai.json ç›®æ ‡ schemaï¼ˆåˆç‰ˆï¼‰

å½“ `status = "ready"` æ—¶ï¼Œ`planning` å­—æ®µç›®æ ‡ç»“æ„å¦‚ä¸‹ï¼ˆå­—æ®µå¯è¿­ä»£ï¼Œä½†å°½é‡ä¿æŒå…¼å®¹ï¼‰ï¼š

```json
{
  "schema_version": 1,
  "meta": {
    "id": "task-20251114-2259-001",
    "title": "ä¸º src æ·»åŠ ä¸€ä¸ª Java æ‰“å°é€»è¾‘",
    "risk": "low | medium | high | critical",
    "owner": "@you"
  },
  "why": "ä¸ºä»€ä¹ˆè¦åšï¼ˆ1â€“3 å¥è¯ï¼‰",
  "what": "å¤§è‡´æ”¹åŠ¨å†…å®¹ï¼ˆ1â€“3 æ®µæ–‡å­—ï¼‰",

  "requirements": [
    {
      "id": "REQ-1",
      "title": "åœ¨ src ä¸­æ·»åŠ ä¸€ä¸ª Java ç¨‹åºï¼Œæ‰“å°â€œå¥½ä½ â€",
      "shall": "The system SHALL print the exact string \"å¥½ä½ \" to stdout when the new script is invoked.",
      "rationale": "å¯é€‰ï¼Œè§£é‡ŠåŸå› æˆ–èƒŒæ™¯",
      "scenarios": [
        {
          "name": "basic invocation",
          "steps": [
            "å¼€å‘è€…åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œçº¦å®šå‘½ä»¤ï¼ˆä¾‹å¦‚ ./scripts/hello.shï¼‰ã€‚",
            "ç»ˆç«¯è¾“å‡ºä¸€è¡Œï¼š`å¥½ä½ `ã€‚"
          ],
          "notes": "å¯é€‰è¡¥å……è¯´æ˜/è¾¹ç•Œæƒ…å†µã€‚"
        }
      ]
    }
  ],

  "targets": [
    "src/",
    "scripts/"
  ],

  "risks": [
    "è¯¯æ”¹ç°æœ‰ä¸šåŠ¡ä»£ç ï¼Œå¯¼è‡´æ„å»ºå¤±è´¥ã€‚",
    "Shell/Java ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜ã€‚"
  ],

  "acceptance": [
    "åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œçº¦å®šè„šæœ¬èƒ½æ‰“å°â€œå¥½ä½ â€ã€‚",
    "CI ä¸­ç›¸å…³æµ‹è¯•é€šè¿‡ã€‚"
  ],

  "draft_files": [
    "src/Main.java",
    "scripts/hello.sh"
  ],

  "tasks": [
    "åœ¨ src ä¸‹æ·»åŠ  Java å…¥å£ç±» Mainï¼Œå®Œæˆæ‰“å°é€»è¾‘ã€‚",
    "åœ¨ scripts ä¸‹æ·»åŠ  hello.shï¼Œè°ƒç”¨ Java ç¨‹åºæˆ–ç›´æ¥æ‰“å°ã€‚",
    "ä¸ºæ–°é€»è¾‘æ·»åŠ è‡³å°‘ä¸€ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚",
    "æ›´æ–° README æˆ–ç›¸å…³æ–‡æ¡£ã€‚"
  ],

  "notes": "å¯é€‰çš„è¡¥å……è¯´æ˜æˆ–å¾…ç¡®è®¤äº‹é¡¹ã€‚"
}
```

çº¦æŸä¸ç”¨é€”ï¼š

- `schema_version`ï¼šç”¨äºæœªæ¥ schema è°ƒæ•´æ—¶åšå…¼å®¹å¤„ç†ï¼ˆå½“å‰ä¸º 1ï¼Œåç»­æ¼”è¿›æ—¶åªè¿½åŠ å­—æ®µï¼Œå°½é‡ä¸ç ´åå·²å­˜åœ¨çš„é”®ï¼‰ã€‚
- `meta`ï¼šç”¨äº change.md çš„ YAML å¤´éƒ¨ï¼ˆid/title/risk/ownerï¼‰ã€‚
- `why` / `what`ï¼šç”¨äº change.md çš„ `## Why` / `## What Changes` æ®µã€‚
- `requirements`ï¼š
  - æ¯æ¡ requirement å°†æ˜ å°„ä¸º spec.md ä¸­çš„ä¸€ä¸ª requirement åŒºå—ï¼›
  - `shall` å¿…é¡»ä½¿ç”¨è‹±æ–‡ SHALL å¥å¼ï¼Œæ–¹ä¾¿ OpenSpec æ ¡éªŒï¼›
  - æ¯æ¡ requirement è‡³å°‘åº”æœ‰ä¸€ä¸ª scenarioã€‚
- `targets`ï¼šç”¨äº change.md çš„ `## Targets` æ®µã€‚
- `risks`ï¼šç”¨äº change.md çš„ `## Risks and Mitigations` æ®µã€‚
- `acceptance`ï¼šç”¨äº change.md çš„ `## Acceptance` æ®µã€‚
- `draft_files`ï¼š
  - å°†å†™å…¥ `tasks/<taskId>/plan.files.json` ä¸­çš„ `files` æ•°ç»„ï¼›
  - codegen ä»…å¯¹è¿™äº›æ–‡ä»¶è¿›è¡Œç”Ÿæˆ/ä¿®æ”¹ï¼ˆå¦‚ä¸ºç©ºåˆ™å®å¯å¤±è´¥ï¼Œä¸åšå…œåº•ï¼‰ã€‚
- `tasks`ï¼šç”¨äº tasks.md çš„ä»»åŠ¡åˆ—è¡¨ã€‚
- `notes`ï¼šä»…ç”¨äºäººç±»é˜…è¯»ä¸åç»­è°ƒæ•´ï¼Œä¸ç›´æ¥è¿›å…¥ OpenSpec æ ¡éªŒé€»è¾‘ã€‚

### 2.1 è§„åˆ’ä¿¡æ¯çš„åç»­æ‰©å±•æ–¹å‘ï¼ˆæš‚ä¸å¼ºåˆ¶ï¼‰

åœ¨ä¸ç ´åç°æœ‰å­—æ®µçš„å‰æä¸‹ï¼Œæœªæ¥å¯ä»¥æŒ‰ä»¥ä¸‹æ–¹å‘é€æ­¥ä¸°å¯Œ `planning`ï¼š

- `scope` / `non_goals`ï¼š
  ```json
  "scope": ["æœ¬æ¬¡å¿…é¡»å®Œæˆçš„èŒƒå›´ç‚¹"],
  "non_goals": ["æœ¬æ¬¡æ˜ç¡®ä¸åšçš„äº‹æƒ…"]
  ```
  - ç”¨äºåœ¨ plan.md æˆ– planning æ‘˜è¦ä¸­æ›´æ¸…æ™°åœ°è¡¨è¾¾ä»»åŠ¡è¾¹ç•Œã€‚

- `design`ï¼ˆå®ç°æ€è·¯ï¼‰ï¼š
  ```json
  "design": {
    "overview": "æ•´ä½“å®ç°æ€è·¯ï¼ˆ1â€“3 æ®µï¼‰",
    "key_decisions": ["å…³é”®è®¾è®¡å†³ç­– 1", "å…³é”®è®¾è®¡å†³ç­– 2"],
    "alternatives": ["æ›¾è€ƒè™‘ä½†æ”¾å¼ƒçš„æ–¹æ¡ˆï¼ˆå¯é€‰ï¼‰"],
    "dependencies": ["ä¾èµ–çš„æ¨¡å—/å¤–éƒ¨æœåŠ¡ï¼ˆå¯é€‰ï¼‰"]
  }
  ```
  - ä¸»è¦æœåŠ¡äº codegen/review é˜¶æ®µçš„ä¸Šä¸‹æ–‡ï¼Œä¸å¿…å…¨éƒ¨æ˜ å°„åˆ° OpenSpecã€‚

- `file_impacts`ï¼ˆæŒ‰æ–‡ä»¶çš„å½±å“è¯´æ˜ï¼‰ï¼š
  ```json
  "file_impacts": [
    {
      "path": "src/Calculator.java",
      "purpose": "æ–°å¢ä¸€ä¸ªç®€å•è®¡ç®—å™¨ç±»ï¼Œç”¨äºæ¼”ç¤º",
      "type": "create | modify | delete",
      "notes": "ä¾‹å¦‚ä¸å“ªäº›ç°æœ‰ç±»äº¤äº’"
    }
  ]
  ```
  - `path` å¯æ±‡æ€»åˆ° `draft_files` ä¸­é©±åŠ¨ codegenï¼›
  - å…¶ä½™å­—æ®µç”¨äºç”Ÿæˆæ›´ç»†ç²’åº¦çš„æç¤ºï¼ˆè®¾è®¡/å®¡æŸ¥æ‘˜è¦ï¼‰ã€‚

- `test_plan`ï¼ˆæµ‹è¯•ä¸éªŒæ”¶ç»†åŒ–ï¼‰ï¼š
  ```json
  "test_plan": {
    "strategy": "æ•´ä½“æµ‹è¯•ç­–ç•¥",
    "cases": ["æµ‹è¯•ç”¨ä¾‹ 1", "æµ‹è¯•ç”¨ä¾‹ 2"],
    "automation": "éœ€è¦/ä¸éœ€è¦è‡ªåŠ¨åŒ–æµ‹è¯•åŠèŒƒå›´"
  }
  ```
  - ä¸ `acceptance` é…åˆï¼Œä¸º eval/CI è®¾è®¡æä¾›å‚è€ƒã€‚

- `open_questions`ï¼ˆå¼€æ”¾é—®é¢˜ï¼‰ï¼š
  ```json
  "open_questions": ["ä»ç„¶ä¸ç¡®å®šçš„é—®é¢˜ 1", "é—®é¢˜ 2"]
  ```
  - åœ¨ REPL æ‘˜è¦ä¸­å¯ä»¥å•ç‹¬å±•ç¤ºï¼Œæé†’ç”¨æˆ·è§„åˆ’ä¸­å°šå¾…æ¾„æ¸…çš„éƒ¨åˆ†ã€‚

> ä»¥ä¸Šå­—æ®µç›®å‰è§†ä½œâ€œå¯é€‰æ‰©å±•â€ï¼Œä¼˜å…ˆåœ¨ prompt ä¸­å°è¯•äº§å‡ºï¼ŒåŒæ—¶ç¡®ä¿ JSONâ†’OpenSpec æ˜ å°„åœ¨å­—æ®µç¼ºå¤±æ—¶é‡‡å–â€œæœ‰åˆ™ç”¨ã€æ— åˆ™è·³è¿‡â€çš„ç­–ç•¥ã€‚

---

## 3. JSON â†’ OpenSpec æ–‡æœ¬æ˜ å°„ï¼ˆæœºæ¢°ç”Ÿæˆï¼‰

åŸºäºä¸Šè¿° schemaï¼Œä»£ç å±‚å°†æŒ‰å¦‚ä¸‹æ–¹å¼ç”Ÿæˆ OpenSpec æ–‡ä»¶ï¼š

- `change.md`
  - YAML front-matterï¼š
    - `id` â† `planning.meta.id` æˆ– `task-<taskId>`
    - `title` â† `planning.meta.title`
    - `owner` â† `planning.meta.owner`ï¼ˆé»˜è®¤ `@you`ï¼‰
    - `risk` â† `planning.meta.risk`ï¼ˆé»˜è®¤ `medium`ï¼‰
  - æ­£æ–‡ï¼š
    - `## Why` â† `planning.why`
    - `## What Changes` â† `planning.what`
    - `## Requirements` â† `planning.requirements[].title` æˆ–ç®€åŒ–æè¿°
    - `## Targets` â† `planning.targets`
    - `## Risks and Mitigations` â† `planning.risks`
    - `## Acceptance` â† `planning.acceptance`

- `specs/task/spec.md`
  - å¼€å¤´ï¼š`## ADDED Requirements`
  - å¯¹äºæ¯ä¸ª `requirements[i]`ï¼š
    ```markdown
    ### Requirement: <title> (ID: <id>)

    The system SHALL: <shall>

    #### Scenario: <scenario.name>
    - <scenario.steps[0]>
    - <scenario.steps[1]>
    ...
    ```

- `tasks.md`
  ```markdown
  # Tasks

  1. <tasks[0]>
  2. <tasks[1]>
  ...
  ```

- `plan.files.json`
  ```json
  { "files": [ /* draft_files */ ] }
  ```

---

## 4. planning prompt è®¾è®¡è¦ç‚¹ï¼ˆå¾…ç»†åŒ–ï¼‰

åœ¨ `planning` è§’è‰²çš„ç³»ç»Ÿ prompt ä¸­ï¼Œéœ€è¦æ˜ç¡®ï¼š

1. è§’è‰²ä¸ç›®æ ‡
   - ä½ æ˜¯èµ„æ·±è½¯ä»¶è§„åˆ’åŠ©æ‰‹ï¼Œè´Ÿè´£ä¸ºå•ä¸ªå¼€å‘ä»»åŠ¡äº§å‡ºè§„èŒƒã€å¯æ‰§è¡Œçš„è§„åˆ’ JSONï¼Œç”¨äºé©±åŠ¨ OpenSpec å’Œåç»­ codegen/review/evalã€‚

2. è¾“å‡ºå¥‘çº¦
   - ä¸¥æ ¼è¾“å‡ºä¸€ä¸ª JSON å¯¹è±¡ï¼Œç»“æ„ä¸ºï¼š
     - `status`: `"need_clarification"` æˆ– `"ready"`;
     - `questions`: string[]ï¼›
     - `planning`: å¯¹è±¡ï¼Œç¬¦åˆæœ¬æ–‡ä»¶å®šä¹‰çš„ schemaã€‚
   - ä¸å…è®¸è¾“å‡º Markdown ä»£ç å—æ ‡è®°ï¼ˆ```ï¼‰ã€æ³¨é‡Šæˆ–é¢å¤–è§£é‡Šæ–‡å­—ã€‚

3. status ä¸å¤šè½®æ¾„æ¸…è§„åˆ™
   - è‹¥å½“å‰ä¿¡æ¯ä¸è¶³ä»¥å®‰å…¨ç”Ÿæˆè§„åˆ’ï¼š
     - è®¾ `status = "need_clarification"`ï¼›
     - åœ¨ `questions` ä¸­ç»™å‡º 1â€“3 ä¸ªå…³é”®é—®é¢˜ï¼ˆé¿å…ä¸€æ¬¡æ€§é—®å¤ªå¤šï¼‰ï¼›
     - `planning` å¯ä»¥ä¸ºç©ºå¯¹è±¡ã€‚
   - è‹¥ä¿¡æ¯å·²ç»è¶³å¤Ÿï¼š
     - è®¾ `status = "ready"`ï¼›
     - `questions` ç½®ä¸ºç©ºæ•°ç»„ï¼›
     - å®Œæ•´å¡«å…… `planning` å¯¹è±¡ï¼ˆå°¤å…¶æ˜¯ `requirements` ä¸ `draft_files`ï¼‰ã€‚
   - å¤šè½®çº¦æŸï¼ˆå®ç°å±‚çº¦å®šï¼‰ï¼š
     - ç³»ç»Ÿæœ€å¤šå…è®¸ 3â€“5 è½® `need_clarification` å¾ªç¯ï¼›åˆ°è¾¾ä¸Šé™ä»æ— æ³• `ready` æ—¶ï¼Œæ¨¡å‹åº”åœ¨ `notes` ä¸­è¯´æ˜æ— æ³•ç»™å‡ºå¯é è§„åˆ’çš„åŸå› ï¼Œå¹¶ç»™å‡ºå½“å‰æœ€ä¿å®ˆçš„å»ºè®®ã€‚

4. draft_files çš„çº¦æŸ
   - `draft_files` åº”åˆ—å‡ºä½ å»ºè®®æ–°å¢/ä¿®æ”¹çš„å…·ä½“æ–‡ä»¶è·¯å¾„ï¼Œåç»­ codegen åªå¯¹è¿™äº›æ–‡ä»¶ç”Ÿæˆä»£ç ï¼›
   - å°½é‡å¤ç”¨ç°æœ‰ç›®å½•ç»“æ„ï¼Œå¦‚ `src/`, `app/`, `scripts/`ï¼›
   - ä¸è¦åŒ…å«ä¾èµ–ç›®å½•æˆ–æ„å»ºäº§ç‰©ç›®å½•ï¼ˆå¦‚ `node_modules`, `build/`, `.git/` ç­‰ï¼‰ã€‚

5. requirements ä¸ scenarios çš„è¦æ±‚
   - æ¯æ¡ requirement éƒ½åº”æœ‰ä¸€ä¸ªç®€æ´æ˜äº†çš„ `title` å’Œä¸€æ¡è‹±æ–‡ SHALL å¥å¼çš„ `shall` æè¿°ï¼›
   - å¦‚æœ‰å¿…è¦ï¼Œè¡¥å…… `scenarios`ï¼Œåˆ—å‡ºå…¸å‹ä½¿ç”¨åœºæ™¯åŠæ­¥éª¤ï¼Œç”¨äºé©±åŠ¨éªŒæ”¶ä¸æµ‹è¯•ã€‚

6. å¤±è´¥ä¸ notes
   - å½“ä½ ä»ç„¶æ— æ³•ç»™å‡ºå¯é è§„åˆ’æ—¶ï¼Œåº”åœ¨ `notes` ä¸­è¯´æ˜åŸå› å’Œéœ€è¦è¿›ä¸€æ­¥æ¾„æ¸…çš„é—®é¢˜ï¼Œä½†ä»è¾“å‡ºä¸€ä¸ªç»“æ„å®Œæ•´çš„ JSONï¼ˆä½¿ç”¨æœ€ä¿å®ˆå‡è®¾ï¼‰ã€‚

7. è®¡è´¹ä¸ usage è®°å½•ï¼ˆåç»­å¢å¼ºï¼‰
   - å„ provider çš„è®¡è´¹è§„åˆ™ä¸åŒï¼ˆæŒ‰ tokens æˆ–æŒ‰è°ƒç”¨ï¼‰ï¼Œå› æ­¤å½“å‰é˜¶æ®µä»…è®°å½•åŸå§‹ `usage` å­—æ®µï¼ˆå¦‚ prompt_tokens / completion_tokens / total_tokensï¼‰ï¼Œä¸è¯•å›¾åœ¨ CLI å†…è®¡ç®—é‡‘é¢ã€‚
   - åç»­å¯æŒ‰ provider ç»´æŠ¤ä¸€ä»½ä»·æ ¼è¡¨ï¼Œåœ¨æ—¥å¿—èšåˆæˆ– UI å±‚ä¼°ç®— costï¼Œä½†ä¸åº”ç¡¬ç¼–ç åœ¨è§„åˆ’ prompt ä¸­ã€‚

> åç»­å·¥ä½œï¼šå°†æœ¬æ–‡ä»¶ä¸­çš„ schema ä¸çº¦æŸå›ºåŒ–åˆ° `planning` çš„ç³»ç»Ÿ prompt ä¸­ï¼ˆå¯æ”¾åœ¨ `.ai-tools-chain/prompts/planning.md`ï¼‰ï¼Œå¹¶åœ¨ `runAIPlanningAndOpenSpec` / REPL `/plan` ä¸­å®ç°å¤šè½® `status`/`questions` å¯¹è¯å¾ªç¯ï¼ˆå¸¦ historyï¼‰ï¼Œå°†æœ€ç»ˆ `planning` å¯¹è±¡ä¼ å…¥ OpenSpec æ˜ å°„é€»è¾‘ï¼›åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¯¹ codegen / review / second_opinion ç­‰è§’è‰²ä¹Ÿç»Ÿä¸€è®°å½• usageï¼Œä»¥ä¾¿åç»­åšè·¨ provider çš„è®¡è´¹ç»Ÿè®¡ã€‚ 

---

## 5. Planning Meetingï¼ˆè§„åˆ’ä¼šè®®ï¼‰schemaï¼ˆåˆç‰ˆè‰æ¡ˆï¼‰

> è¯´æ˜ï¼šæœ¬èŠ‚å®šä¹‰ `tasks/<taskId>/planning/planning.meeting.json` çš„ç›®æ ‡ç»“æ„ã€‚  
> å½“å‰å®ç°åªè¦†ç›–å…¶ä¸­ä¸€éƒ¨åˆ†å­—æ®µï¼Œå‰©ä½™å­—æ®µå°†åœ¨ M12 åŠä¹‹åé€æ­¥å¡«å……ã€‚

é¡¶å±‚ç»“æ„å»ºè®®å¦‚ä¸‹ï¼š

```json
{
  "taskId": "20251117-1500-001",
  "title": "ä¸ºé¡¹ç›®æ·»åŠ ä¸€ä¸ª shell è®¡ç®—å™¨",
  "ok": true,
  "planning_summary": {
    "why": "...",
    "what": "...",
    "scope": "...",
    "nonGoalsCount": 1,
    "openQuestionsCount": 0,
    "requirementsCount": 3,
    "draftFilesCount": 2,
    "acceptanceCount": 2
  },
  "issues": [],
  "plan_md_present": true,

  "rounds": [
    {
      "round": 1,
      "at": "2025-11-17T15:00:00.000Z",
      "input_snapshot": {
        "brief": "ç”¨æˆ·åŸå§‹éœ€æ±‚æ–‡æœ¬æˆ–æ‘˜è¦",
        "user_feedback": "ä¸Šä¸€è½®ç”¨æˆ·åé¦ˆçš„è¦ç‚¹ï¼ˆå¦‚æœ‰ï¼‰"
      },
      "per_role_verdicts": {
        "product": {
          "ok": true,
          "confidence": 0.8,
          "reasons": ["éœ€æ±‚èŒƒå›´åŸºæœ¬æ¸…æ™°", "non_goals ä»å¯è¡¥å……"],
          "suggestions": ["åœ¨ä¸‹ä¸€è½®è¡¥ä¸Šéç›®æ ‡è¯´æ˜"]
        },
        "system": {
          "ok": true,
          "confidence": 0.7,
          "reasons": ["æŠ€æœ¯æ–¹æ¡ˆå¯è¡Œ"],
          "suggestions": []
        },
        "test": {
          "ok": false,
          "confidence": 0.9,
          "reasons": ["ç¼ºå°‘ test_plan.cases"],
          "suggestions": ["ä¸‹ä¸€è½®éœ€è¡¥å……å…³é”®ç”¨ä¾‹"]
        }
      },
      "options": [
        {
          "name": "æ–¹æ¡ˆ Aï¼šçº¯ shell",
          "pros": ["å®ç°æœ€å¿«", "ä¾èµ–æœ€å°‘"],
          "cons": ["æ‰©å±•æ€§æœ‰é™"]
        }
      ],
      "coach_summary": "æœ¬è½®ç¡®è®¤äº†éœ€æ±‚èŒƒå›´ä¸æŠ€æœ¯æ–¹æ¡ˆï¼Œæµ‹è¯•åŒå­¦è¦æ±‚ä¸‹ä¸€è½®è¡¥å…… test_planã€‚",
      "decision": "redo_planning"  // go | hold | redo_planning | ask_user | ask_more_info
    }
  ],

  "ai_meeting": {
    "summary": "è‡ªç„¶è¯­è¨€ä¼šè®®æ€»ç»“ï¼ˆå½“å‰å¯é€‰å­—æ®µï¼‰",
    "key_points": ["..."],
    "risks": ["..."],
    "open_questions": ["..."],
    "next_actions": ["..."],
    "decision": "go | hold | redo_planning"
  }
}
```

å­—æ®µè¯´æ˜ï¼ˆåˆç‰ˆï¼‰ï¼š

- é¡¶å±‚ï¼š  
  - `taskId` / `title`ï¼šä¸ `planning.ai.json` å¯¹é½ï¼Œç”¨äºå¿«é€Ÿå®šä½ä¼šè®®ä¸Šä¸‹æ–‡ï¼›  
  - `ok`ï¼šæ•´ä½“ gate ç»“æœï¼ˆç›®å‰ç­‰ä»·äº plan_review.okï¼‰ï¼Œæœªæ¥å¯ä»¥ç»¼åˆå¤šè½®å†³ç­–ï¼›  
  - `planning_summary`ï¼šåŸºäºå½“å‰è§„åˆ’æç‚¼å‡ºçš„æ ¸å¿ƒç»Ÿè®¡ä¿¡æ¯ï¼Œä¾¿äº codegen/review/test å¿«é€Ÿäº†è§£èŒƒå›´ä¸å¯†åº¦ï¼›  
  - `issues`ï¼šæ¥è‡ª plan_review + openspec çš„é—®é¢˜åˆ—è¡¨ï¼›  
  - `plan_md_present`ï¼šæ˜¯å¦å­˜åœ¨ plan.mdã€‚

- `rounds[]`ï¼š  
  - æ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€æ¬¡â€œè§„åˆ’å†™ä½œè½®æ¬¡â€ï¼ˆRoundï¼‰ï¼Œè¿™æ˜¯ M12 ä»¥åçš„é‡ç‚¹æ‰©å±•å¯¹è±¡ï¼›  
  - `input_snapshot`ï¼šæœ¬è½®å¼€å§‹æ—¶çš„è¾“å…¥æƒ…å†µï¼Œè‡³å°‘åŒ…å« brief/ç”¨æˆ·åé¦ˆæ‘˜è¦ï¼›  
  - `per_role_verdicts`ï¼šæŒ‰è§’è‰²è®°å½•å„è‡ªçš„åˆ¤æ–­ä¸å»ºè®®ï¼š  
    - è§’è‰²å‘½åå»ºè®®ï¼š`product/system/test/risk/...`ï¼Œåç»­å¯åœ¨æ–‡æ¡£ä¸­å›ºåŒ–ï¼›  
    - æ¯ä¸ª verdict ä¸­çš„å­—æ®µä¸ºï¼š  
      - `ok`ï¼šè¯¥è§’è‰²æ˜¯å¦è®¤ä¸ºå½“å‰è§„åˆ’åœ¨å…¶èŒè´£èŒƒå›´å†…å¯æ¥å—ï¼›  
      - `confidence`ï¼š0â€“1 ä¹‹é—´çš„ç½®ä¿¡åº¦ï¼ˆå¯é€‰ï¼‰ï¼›  
      - `reasons[]`ï¼šä¸»è¦åŸå› ï¼›  
      - `suggestions[]`ï¼šä¸‹ä¸€è½®åº”åšçš„è°ƒæ•´æˆ–éœ€è¦è¡¥å……çš„ä¿¡æ¯ã€‚  
  - `options[]`ï¼šæœ¬è½®å¦‚æœå‡ºç°äº†å¤šä¸ªå¤‡é€‰æ–¹æ¡ˆï¼Œè®°å½•å„æ–¹æ¡ˆçš„ name/pros/consï¼Œä¾¿äºåç»­å¯¹æ¯”ï¼›  
  - `coach_summary`ï¼šæ•æ·æ•™ç»ƒå¯¹æœ¬è½®è®¨è®ºçš„æ€»ç»“ï¼Œç”¨äººè¯è§£é‡Šâ€œæˆ‘ä»¬å¹²äº†ä»€ä¹ˆã€ç»“è®ºæ˜¯ä»€ä¹ˆâ€ï¼›  
  - `decision`ï¼šæœ¬è½®çš„å†³ç­–ï¼Œå–å€¼å»ºè®®ï¼š  
    - `"go"`ï¼šå¯ä»¥è¿›å…¥ codegenï¼›  
    - `"hold"`ï¼šå½“å‰è½®å…ˆä¸è¿›å…¥ codegenï¼Œä½†ä¸å¼ºåˆ¶ redoï¼Œå¯ç­‰ç”¨æˆ·è¿›ä¸€æ­¥åé¦ˆï¼›  
    - `"redo_planning"`ï¼šéœ€è¦æ–°ä¸€è½®è§„åˆ’ï¼›  
    - `"ask_user"`ï¼šéœ€è¦ç”¨æˆ·å›ç­”æŸäº›é—®é¢˜ï¼›  
    - `"ask_more_info"`ï¼šéœ€è¦å†…éƒ¨ä¸“å®¶è¿›ä¸€æ­¥è°ƒç ”ã€‚

- `ai_meeting`ï¼š  
  - ä¿æŒä¸ç°æœ‰ `planning_meeting` æ¨¡å‹è¾“å‡ºå…¼å®¹çš„å­—æ®µï¼š`summary/key_points/risks/open_questions/next_actions/decision`ï¼›  
  - å½“å‰å®ç°å·²éƒ¨åˆ†ä½¿ç”¨è¿™äº›å­—æ®µæ¥ç”Ÿæˆ Markdown ä¼šè®®çºªè¦ï¼Œæœªæ¥å¯ä»¥å°†å…¶è§†ä¸ºâ€œæ•™ç»ƒè§†è§’â€çš„è‡ªç„¶è¯­è¨€è¡¥å……ã€‚

å½“å‰å®ç°æƒ…å†µï¼ˆM11/M11+ï¼‰ï¼š

- å·²å­˜åœ¨çš„å­—æ®µï¼š`taskId/title/ok/planning_summary/issues/plan_md_present/ai_meeting`ï¼›  
- å°šæœªå®ç°ä½†åœ¨æœ¬ schema ä¸­é¢„ç•™çš„å­—æ®µï¼š`rounds[]/per_role_verdicts/options/coach_summary/decision`ã€‚  

> çº¦å®šï¼šåœ¨è¿™äº›å­—æ®µæœªå®Œå…¨å®ç°ä¹‹å‰ï¼Œæ¶ˆè´¹æ–¹ï¼ˆcodegen/review/test/Orchestratorï¼‰åº”å°†å®ƒä»¬è§†ä¸º **best-effort å¢å¼ºä¿¡æ¯**ï¼Œ  
> ç¼ºå¤±æ—¶ä¸å¾—å¯¼è‡´æµç¨‹å¤±è´¥ï¼›å¯¹å¤–åè®®å¦‚æœ‰è°ƒæ•´ï¼Œåº”æ›´æ–°æœ¬èŠ‚å®šä¹‰å¹¶åœ¨å˜æ›´è¯´æ˜ä¸­æ ‡æ˜ç‰ˆæœ¬ã€‚
